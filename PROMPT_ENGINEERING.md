# NetPulse FX - AI 提示词工程文档

本文档详细记录了 NetPulse FX 项目中针对 **Gemini 2.5** 和 **DeepSeek** 等大语言模型的 Prompt 演进过程，展示了如何通过迭代优化提升 AI 分析网络流量数据的准确性和专业性。

---

## 目录

1. [概述](#概述)
2. [Prompt 演进历程](#prompt-演进历程)
   - [版本 1.0：初始版本（简单提问）](#版本-10初始版本简单提问)
   - [版本 2.0：迭代版本（结构化数据）](#版本-20迭代版本结构化数据)
   - [版本 3.0：专家版本（Chain-of-Thought）](#版本-30专家版本chain-of-thought)
3. [当前使用的 Prompt](#当前使用的-prompt)
4. [最佳实践与经验总结](#最佳实践与经验总结)

---

## 概述

NetPulse FX 使用大语言模型（LLM）对网络流量数据进行智能分析，识别潜在的安全风险、性能瓶颈和优化机会。Prompt 工程的质量直接影响 AI 分析结果的准确性和实用性。

### 核心挑战

1. **数据理解**：如何让 AI 理解网络流量数据的含义（五元组、协议特征、流量模式）
2. **结构化输出**：如何确保 AI 输出格式统一、易于解析和展示
3. **专业性**：如何引导 AI 从网络安全专家的角度进行分析
4. **无废话输出**：如何避免 AI 输出不必要的开场白和客套话

---

## Prompt 演进历程

### 版本 1.0：初始版本（简单提问）

**特点**：直接提问，依赖 AI 的通用知识

**Prompt 示例**：
```
请分析以下网络流量数据，告诉我有什么异常。
[流量数据]
```

**效果评估**：
- ✅ 优点：简单直接，AI 能够理解基本问题
- ❌ 缺点：
  - 输出格式不统一，难以解析
  - 分析深度不够，缺乏专业性
  - 经常包含不必要的开场白和结束语
  - 对网络术语的理解不够准确

**实际输出示例**：
```
好的，我来分析一下这些网络流量数据...

根据您提供的数据，我发现了一些异常情况：
1. 流量较大
2. 有一些可疑连接

希望以上分析对您有帮助。
```

**问题**：输出包含大量废话，格式不统一，分析深度不足。

---

### 版本 2.0：迭代版本（结构化数据）

**改进点**：
1. 明确角色定位（网络安全专家）
2. 提供五元组解释和协议特征描述
3. 要求结构化输出（Markdown 格式）
4. 明确分析维度

**Prompt 示例**：
```
你是一个网络安全专家，请根据以下流量数据分析网络状态。

**数据说明**：
- 五元组：源IP、目标IP、源端口、目标端口、协议类型
- 协议特征：TCP（可靠传输）、UDP（快速传输）、ICMP（网络诊断）
- 流量方向：上行（上传）、下行（下载）

请从以下角度进行分析：
1. 流量趋势：分析流量变化趋势
2. 网络性能：评估网络性能状态
3. 安全风险：识别潜在的安全威胁
4. 优化建议：提供具体的优化建议

请使用中文回答，格式清晰，建议分点列出。
```

**效果评估**：
- ✅ 优点：
  - 角色定位明确，输出更专业
  - 分析维度清晰，覆盖全面
  - 格式要求明确，输出更统一
- ❌ 缺点：
  - 仍然可能包含开场白和结束语
  - 分析逻辑不够深入，缺乏推理过程
  - 对异常情况的识别不够精准

**实际输出示例**：
```
好的，作为一名网络安全专家，我来分析这些数据...

## 流量趋势
- 整体流量呈上升趋势
...

希望以上分析对您有帮助，如有疑问请随时咨询。
```

**问题**：仍然包含开场白和结束语，分析深度有待提升。

---

### 版本 3.0：专家版本（Chain-of-Thought）

**改进点**：
1. **严格禁止废话**：明确要求直接输出报告，禁止任何开场白和结束语
2. **Chain-of-Thought 思路**：要求 AI 按照"现象 -> 风险分析 -> 修复建议"的结构化流程思考
3. **详细的数据说明**：提供五元组、协议特征、流量方向的详细解释
4. **强制 Markdown 格式**：要求直接以标题开始，确保格式统一

**当前使用的 System Prompt**：
```
你是一个网络审计专家，专门负责分析网络监控会话数据。

**重要输出要求：**
1. 严禁输出任何开场白（如"好的，作为一名专家..."、"根据您提供的数据..."等）
2. 严禁输出任何结束语（如"希望以上分析对您有帮助"、"如有疑问请随时咨询"等）
3. 严禁输出任何过渡性废话或客套话
4. 直接以 Markdown 格式的标题开始输出分析报告
5. 只输出报告的正文内容，禁止包含任何对话式的回复

**报告格式要求：**
请根据提供的会话概况信息（时长、网卡、均速）和明细采样数据（异常点、IP 归属、关联进程），生成一份专业的网络行为分析报告。

报告必须使用 Markdown 格式，直接以以下结构开始（不要有任何前言）：

## 1. 流量趋势评估
- 分析整体流量变化趋势（上行/下行）
- 识别流量峰值和低谷时段
- 评估流量模式的稳定性

## 2. 潜在风险识别
- **异常后台上传**：检查是否存在异常的上传行为（如数据泄露迹象）
- **异常下载**：识别异常的大量下载行为
- **异常连接**：分析 IP 归属地，识别可疑的远程连接
- **进程关联**：分析哪些进程产生了异常流量

## 3. 优化建议
- 网络性能优化建议
- 安全防护建议
- 资源使用优化建议

**再次强调：直接以 "## 1. 流量趋势评估" 开始输出，不要有任何开场白或客套话。**
```

**效果评估**：
- ✅ 优点：
  - 输出格式完全统一，直接以标题开始
  - 分析深度显著提升，覆盖多个维度
  - 无废话输出，用户体验更好
  - 结构化程度高，易于解析和展示
- ✅ 实际输出示例：
```
## 1. 流量趋势评估
- 整体流量变化趋势：在监控期间（约 5 分钟），下行流量呈现明显的波动模式...
- 流量峰值和低谷时段：在 14:23:15 时出现下行流量峰值（1250.50 KB/s）...
- 流量模式稳定性：整体流量模式相对稳定，但存在周期性波动...

## 2. 潜在风险识别
- **异常后台上传**：检测到进程 "chrome.exe" 在 14:24:30 时产生异常上行流量（450.20 KB/s）...
- **异常下载**：未发现异常的大量下载行为...
- **异常连接**：检测到与 IP 地址 203.208.60.1（归属地：北京市）的连接，该 IP 属于 Google 服务...
- **进程关联**：主要流量来源进程包括 "chrome.exe"（浏览器）、"steam.exe"（游戏平台）...

## 3. 优化建议
- **网络性能优化建议**：建议检查网络带宽使用情况，考虑在高峰时段限制非关键应用的带宽...
- **安全防护建议**：建议定期检查异常上行流量，防止数据泄露...
- **资源使用优化建议**：建议优化浏览器标签页数量，减少不必要的网络请求...
```

**成功因素**：
1. **明确的约束条件**：多次强调禁止开场白和结束语
2. **结构化模板**：提供具体的报告结构，引导 AI 输出
3. **专业术语解释**：帮助 AI 理解网络数据含义
4. **Chain-of-Thought 思路**：通过结构化的分析流程，引导 AI 进行深度思考

---

## 当前使用的 Prompt

### System Prompt（系统提示词）

当前使用的 System Prompt 已在上述"版本 3.0"中详细展示。该 Prompt 专门用于会话深度分析，具有以下特点：

1. **角色定位**：网络审计专家
2. **输出约束**：严格禁止开场白、结束语和客套话
3. **格式要求**：强制 Markdown 格式，直接以标题开始
4. **分析维度**：流量趋势、风险识别、优化建议

### User Prompt（用户提示词）

User Prompt 由以下部分组成：

1. **会话概况信息**：
   - 会话 ID、网卡名称、开始/结束时间
   - 持续时间、记录总数
   - 平均/最大上行/下行速度
   - 总流量统计
   - 唯一 IP 地址和进程数量

2. **明细采样数据**（JSON 格式）：
   ```json
   {
     "sampledRecords": [
       {
         "downSpeed": 1250.50,
         "upSpeed": 450.20,
         "sourceIp": "192.168.1.100",
         "destIp": "203.208.60.1",
         "processName": "chrome.exe",
         "recordTime": "2024-01-15 14:23:15"
       },
       ...
     ],
     "sampleCount": 100
   }
   ```

3. **分析要求**：
   ```
   请分析以下监控会话的网络行为数据。
   
   [会话概况信息]
   
   **明细采样数据**（共 X 条记录，已采样 Y 条关键数据点）：
   
   [JSON 数据]
   
   请生成一份详细的网络行为分析报告，包含流量趋势评估、潜在风险识别和优化建议。
   ```

### 完整 Prompt 示例

**System Prompt**：
```
你是一个网络审计专家，专门负责分析网络监控会话数据。

**重要输出要求：**
1. 严禁输出任何开场白...
2. 严禁输出任何结束语...
...

**报告格式要求：**
...
```

**User Prompt**：
```
请分析以下监控会话的网络行为数据。

**会话概况**
- **会话 ID**: 1
- **网卡名称**: Realtek PCIe GbE Family Controller
- **开始时间**: 2024-01-15 14:20:00
- **结束时间**: 2024-01-15 14:25:00
- **持续时间**: 300 秒 (5.0 分钟)
- **记录总数**: 1500 条
- **平均下行速度**: 850.50 KB/s
- **平均上行速度**: 320.30 KB/s
...

**明细采样数据**（共 1500 条记录，已采样 100 条关键数据点）：

{
  "sampledRecords": [
    {
      "downSpeed": 1250.50,
      "upSpeed": 450.20,
      "sourceIp": "192.168.1.100",
      "destIp": "203.208.60.1",
      "processName": "chrome.exe",
      "recordTime": "2024-01-15 14:23:15"
    },
    ...
  ],
  "sampleCount": 100
}

请生成一份详细的网络行为分析报告，包含流量趋势评估、潜在风险识别和优化建议。
```

---

## 最佳实践与经验总结

### 1. 明确角色定位

**经验**：为 AI 设定明确的角色（如"网络审计专家"），能够显著提升输出的专业性。

**示例**：
- ❌ 不好：`请分析这些数据`
- ✅ 好：`你是一个网络审计专家，专门负责分析网络监控会话数据`

### 2. 严格约束输出格式

**经验**：多次强调输出格式要求，并明确禁止不需要的内容。

**关键技巧**：
- 使用"严禁"、"禁止"等强烈措辞
- 提供具体的反例（如"好的，作为一名专家..."）
- 要求直接以标题开始输出

### 3. 提供结构化模板

**经验**：提供具体的报告结构模板，引导 AI 按照预期格式输出。

**示例**：
```
报告必须使用 Markdown 格式，直接以以下结构开始：

## 1. 流量趋势评估
- 分析整体流量变化趋势（上行/下行）
- 识别流量峰值和低谷时段
- 评估流量模式的稳定性

## 2. 潜在风险识别
...
```

### 4. 解释专业术语

**经验**：对于网络领域的专业术语（如五元组、协议特征），提供简要解释，帮助 AI 更好地理解数据。

**示例**：
```
**数据说明**：
- 五元组：源IP、目标IP、源端口、目标端口、协议类型
- 协议特征：TCP（可靠传输）、UDP（快速传输）、ICMP（网络诊断）
- 流量方向：上行（上传）、下行（下载）
```

### 5. 使用 Chain-of-Thought 思路

**经验**：通过结构化的分析流程（现象 -> 风险分析 -> 修复建议），引导 AI 进行深度思考。

**实现方式**：
- 明确要求按照特定顺序分析
- 提供每个分析维度的具体要求
- 强调逻辑推理过程

### 6. 数据降采样策略

**经验**：对于大量数据，使用智能降采样策略，保留关键数据点。

**当前策略**：
- 保留前 10% 和后 10% 的记录（时间序列首尾）
- 识别流量峰值点（上行和下行速度最大的前 10 个点）
- 识别流量低谷点（速度最小的前 10 个点）
- 均匀采样中间部分的数据

### 7. 针对不同模型的优化

**Gemini 2.5 特点**：
- 对结构化输出支持较好
- 对中文理解能力强
- 响应速度较快

**DeepSeek 特点**：
- 对技术领域理解深入
- 输出格式较为统一
- 成本较低

**优化建议**：
- 对于 Gemini 2.5，可以要求更详细的 JSON 格式输出
- 对于 DeepSeek，可以强调技术术语的准确性

---

## 未来优化方向

1. **动态 Prompt 调整**：根据数据特征（如数据量、异常程度）动态调整 Prompt
2. **多轮对话支持**：支持用户对 AI 分析结果进行追问和深入分析
3. **领域知识增强**：引入更多网络安全领域的专业知识到 Prompt 中
4. **输出格式验证**：自动验证 AI 输出是否符合预期格式，并进行修正

---

## 参考资料

- [Gemini API 文档](https://ai.google.dev/gemini-api/docs)
- [DeepSeek API 文档](https://platform.deepseek.com/api-docs/)
- [Prompt Engineering 最佳实践](https://platform.openai.com/docs/guides/prompt-engineering)

---

**文档版本**：1.0  
**最后更新**：2024-01-15  
**维护者**：NetPulseFX Team

