<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.LineChart?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.chart.XYChart?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TitledPane?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.MenuButton?>
<?import javafx.scene.control.MenuItem?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.ColumnConstraints?>

<!--
    ä¸»ç•Œé¢å¸ƒå±€æ–‡ä»¶
    ä½¿ç”¨ BorderPane ä½œä¸ºæ ¹å®¹å™¨ï¼Œå³ä¸Šè§’å›ºå®šæŒ‰é’®
    åŒ…å«ï¼šæ ‡é¢˜æ ‡ç­¾ã€ç½‘å¡åˆ—è¡¨è§†å›¾ã€æ“ä½œæŒ‰é’®åŒºåŸŸ
-->
<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.netpulse.netpulsefx.MainController"
            stylesheets="@main-view.css">
    <!-- è®¾ç½®æ•´ä½“å†…è¾¹è· -->
    <padding>
        <Insets bottom="20.0" left="20.0" right="20.0" top="20.0"/>
    </padding>

    <!-- å³ä¸Šè§’å›ºå®šæŒ‰é’®ç»„ -->
    <top>
        <AnchorPane>
            <!-- æ ‡é¢˜æ ‡ç­¾ï¼šæç¤ºç”¨æˆ·é€‰æ‹©ç›‘æŽ§ç½‘å¡ -->
            <Label fx:id="titleLabel" text="è¯·é€‰æ‹©ç›‘æŽ§ç½‘å¡" 
                   styleClass="title-label"
                   style="-fx-font-family: 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', sans-serif; -fx-font-weight: bold;"
                   AnchorPane.leftAnchor="0.0" AnchorPane.topAnchor="0.0"/>
            
            <!-- å³ä¸Šè§’æ“ä½œæŒ‰é’®ç»„ -->
            <HBox spacing="10.0" alignment="CENTER_RIGHT"
                  AnchorPane.rightAnchor="0.0" AnchorPane.topAnchor="0.0">
                <!-- å¸®åŠ©æŒ‰é’®ï¼šæ‰“å¼€å¸®åŠ©ä¸­å¿ƒçª—å£ -->
                <Button fx:id="helpButton" text="å¸®åŠ©" onAction="#onHelpButtonClick"
                        style="-fx-pref-width: 90px; -fx-pref-height: 32px; -fx-background-color: #6c757d; -fx-text-fill: white; -fx-font-size: 13px; -fx-font-weight: bold; -fx-background-radius: 4px; -fx-cursor: hand; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.2), 2, 0, 0, 1);"/>
                
                <!-- é…ç½® API æŒ‰é’® -->
                <Button fx:id="configAIButton" text="é…ç½® API" onAction="#onConfigAIButtonClick"
                        style="-fx-pref-width: 110px; -fx-pref-height: 32px; -fx-background-color: #007bff; -fx-text-fill: white; -fx-font-size: 13px; -fx-font-weight: bold; -fx-background-radius: 4px; -fx-cursor: hand; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.2), 2, 0, 0, 1);"/>
                
                <!-- æŸ¥çœ‹åŽ†å²æ•°æ®æŒ‰é’®ï¼šæ‰“å¼€åŽ†å²æ•°æ®æŸ¥çœ‹çª—å£ -->
                <Button fx:id="viewHistoryButton" text="æŸ¥çœ‹åŽ†å²æ•°æ®" onAction="#onViewHistoryButtonClick"
                        style="-fx-pref-width: 120px;"/>
                
                <!-- å¼€å§‹ç›‘æŽ§æŒ‰é’®ï¼šå¯åŠ¨å¯¹é€‰ä¸­ç½‘å¡çš„æµé‡ç›‘æŽ§ -->
                <Button fx:id="startMonitorButton" text="å¼€å§‹ç›‘æŽ§" onAction="#onStartMonitorButtonClick"
                        style="-fx-pref-width: 120px;"/>
                
                <!-- åœæ­¢ç›‘æŽ§æŒ‰é’®ï¼šåœæ­¢å½“å‰çš„æµé‡ç›‘æŽ§ -->
                <Button fx:id="stopMonitorButton" text="åœæ­¢ç›‘æŽ§" onAction="#onStopMonitorButtonClick"
                        style="-fx-pref-width: 120px;" disable="true"/>
            </HBox>
        </AnchorPane>
    </top>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <center>
        <VBox spacing="20.0">
            <!-- æŽ§åˆ¶åŒºåŸŸï¼šç½‘å¡é€‰æ‹©ã€BPF è¾“å…¥å’ŒæŒ‰é’®ç»„ -->
            <VBox styleClass="control-panel" spacing="12.0">
                <HBox spacing="10.0" alignment="CENTER_LEFT">
                    <ComboBox fx:id="networkInterfaceComboBox" promptText="è¯·é€‰æ‹©è¦ç›‘æŽ§çš„ç½‘å¡..." 
                              prefWidth="400.0" HBox.hgrow="ALWAYS"/>
                    <Button fx:id="refreshNICButton" text="åˆ·æ–°" onAction="#onRefreshButtonClick"
                            style="-fx-pref-width: 80px;"/>
                </HBox>
                <!-- BPF è¿‡æ»¤è¡¨è¾¾å¼è¾“å…¥æ¡†å’Œé¢„è®¾èœå• -->
                <HBox spacing="5.0" alignment="CENTER_LEFT">
                    <TextField fx:id="bpfFilterTextField" promptText="è¾“å…¥ BPF è¿‡æ»¤è¡¨è¾¾å¼ (å¦‚: tcp and port 80)..." 
                               HBox.hgrow="ALWAYS" styleClass="bpf-filter-input"/>
                    <MenuButton fx:id="bpfPresetMenuButton" text="å¿«æ·é¢„è®¾èœå•" style="-fx-pref-width: 140px;">
                        <items>
                            <MenuItem text="ä»…é™ Web æµé‡" onAction="#onBpfPresetWebTraffic"/>
                            <MenuItem text="æŽ’é™¤æœ¬æœºä¼šè¯" onAction="#onBpfPresetExcludeLocal"/>
                            <MenuItem text="DNS ç›‘æŽ§" onAction="#onBpfPresetDns"/>
                            <MenuItem text="å¤§åŒ…å±è”½" onAction="#onBpfPresetSmallPackets"/>
                        </items>
                    </MenuButton>
                </HBox>
            </VBox>
            
            <!-- æ•°æ®ç»Ÿè®¡å¡ç‰‡ï¼ˆGridPaneå¸ƒå±€ï¼‰ -->
            <GridPane hgap="15.0" vgap="15.0" VBox.vgrow="NEVER">
                <columnConstraints>
                    <ColumnConstraints hgrow="ALWAYS" minWidth="200.0" prefWidth="250.0"/>
                    <ColumnConstraints hgrow="ALWAYS" minWidth="200.0" prefWidth="250.0"/>
                    <ColumnConstraints hgrow="ALWAYS" minWidth="200.0" prefWidth="250.0"/>
                    <ColumnConstraints hgrow="ALWAYS" minWidth="200.0" prefWidth="250.0"/>
                </columnConstraints>
                
                <!-- å®žæ—¶ä¸‹è¡Œé€Ÿåº¦å¡ç‰‡ -->
                <VBox styleClass="stats-card download" spacing="8.0" GridPane.columnIndex="0" GridPane.rowIndex="0">
                    <HBox spacing="8.0" alignment="CENTER_LEFT">
                        <Label text="â¬‡" styleClass="stats-card-icon"/>
                        <VBox spacing="4.0">
                            <Label text="å®žæ—¶ä¸‹è¡Œ" styleClass="stats-card-title"/>
                            <HBox spacing="4.0" alignment="BASELINE_LEFT">
                                <Label fx:id="realtimeDownLabel" text="0.00" styleClass="stats-card-value"/>
                                <Label text="KB/s" styleClass="stats-card-unit"/>
                            </HBox>
                        </VBox>
                    </HBox>
                </VBox>
                
                <!-- å®žæ—¶ä¸Šè¡Œé€Ÿåº¦å¡ç‰‡ -->
                <VBox styleClass="stats-card upload" spacing="8.0" GridPane.columnIndex="1" GridPane.rowIndex="0">
                    <HBox spacing="8.0" alignment="CENTER_LEFT">
                        <Label text="â¬†" styleClass="stats-card-icon"/>
                        <VBox spacing="4.0">
                            <Label text="å®žæ—¶ä¸Šè¡Œ" styleClass="stats-card-title"/>
                            <HBox spacing="4.0" alignment="BASELINE_LEFT">
                                <Label fx:id="realtimeUpLabel" text="0.00" styleClass="stats-card-value"/>
                                <Label text="KB/s" styleClass="stats-card-unit"/>
                            </HBox>
                        </VBox>
                    </HBox>
                </VBox>
                
                <!-- å³°å€¼é€Ÿåº¦å¡ç‰‡ -->
                <VBox styleClass="stats-card peak" spacing="8.0" GridPane.columnIndex="2" GridPane.rowIndex="0">
                    <HBox spacing="8.0" alignment="CENTER_LEFT">
                        <Label text="ðŸ“ˆ" styleClass="stats-card-icon"/>
                        <VBox spacing="4.0">
                            <Label text="å³°å€¼é€Ÿåº¦" styleClass="stats-card-title"/>
                            <HBox spacing="4.0" alignment="BASELINE_LEFT">
                                <Label fx:id="peakSpeedLabel" text="0.00" styleClass="stats-card-value"/>
                                <Label text="KB/s" styleClass="stats-card-unit"/>
                            </HBox>
                        </VBox>
                    </HBox>
                </VBox>
                
                <!-- æ€»æµé‡å¡ç‰‡ -->
                <VBox styleClass="stats-card total" spacing="8.0" GridPane.columnIndex="3" GridPane.rowIndex="0">
                    <HBox spacing="8.0" alignment="CENTER_LEFT">
                        <Label text="ðŸ“Š" styleClass="stats-card-icon"/>
                        <VBox spacing="4.0">
                            <Label text="æ€»æµé‡" styleClass="stats-card-title"/>
                            <HBox spacing="4.0" alignment="BASELINE_LEFT">
                                <Label fx:id="totalTrafficLabel" text="0.00" styleClass="stats-card-value"/>
                                <Label text="MB" styleClass="stats-card-unit"/>
                            </HBox>
                        </VBox>
                    </HBox>
                </VBox>
            </GridPane>

            <!-- å®žæ—¶æµé‡æ³¢å½¢å›¾ï¼šæ˜¾ç¤ºç½‘ç»œæµé‡çš„å®žæ—¶å˜åŒ–
                 Xè½´ï¼šæ—¶é—´ï¼ˆCategoryAxisï¼‰
                 Yè½´ï¼šæµé‡ KB/sï¼ˆNumberAxisï¼‰
                 ç¦ç”¨åŠ¨ç”»ä»¥æå‡å®žæ—¶æ¸²æŸ“æ€§èƒ½ -->
            <Label text="å®žæ—¶æµé‡ç›‘æŽ§" styleClass="section-label" style="-fx-font-family: 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', sans-serif; -fx-font-weight: bold;"/>
            <LineChart fx:id="trafficChart" animated="false" VBox.vgrow="ALWAYS" createSymbols="true" styleClass="area-chart">
                <xAxis>
                    <CategoryAxis label="æ—¶é—´" />
                </xAxis>
                <yAxis>
                    <NumberAxis label="æµé‡ (KB/s)" />
                </yAxis>
                <minHeight>250.0</minHeight>
            </LineChart>

            <!-- è¿›ç¨‹æµé‡ç›‘æŽ§é¢æ¿ -->
            <TitledPane text="è¿›ç¨‹æµé‡è¯¦æƒ…" collapsible="true" expanded="true" style="-fx-font-family: 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', sans-serif; -fx-font-weight: bold;">
                <TableView fx:id="processTrafficTable" VBox.vgrow="ALWAYS">
                    <columns>
                        <TableColumn fx:id="processNameColumn" text="åº”ç”¨" prefWidth="200.0" />
                        <TableColumn fx:id="processPidColumn" text="PID" prefWidth="80.0" />
                        <TableColumn fx:id="processDownloadSpeedColumn" text="ä¸‹è½½é€Ÿåº¦" prefWidth="120.0" />
                        <TableColumn fx:id="processUploadSpeedColumn" text="ä¸Šä¼ é€Ÿåº¦" prefWidth="120.0" />
                    </columns>
                    <minHeight>200.0</minHeight>
                    <maxHeight>300.0</maxHeight>
                </TableView>
            </TitledPane>
        </VBox>
    </center>
    
    <!-- åº•éƒ¨çŠ¶æ€æ  -->
    <bottom>
        <HBox spacing="20.0" alignment="CENTER_LEFT" styleClass="status-bar">
            <padding>
                <Insets bottom="5.0" left="15.0" right="15.0" top="5.0"/>
            </padding>
            
            <!-- ç³»ç»Ÿè¿è¡Œæ—¶é—´ -->
            <HBox spacing="5.0" alignment="CENTER_LEFT">
                <Label text="è¿è¡Œæ—¶é—´:" styleClass="status-label"/>
                <Label fx:id="uptimeLabel" text="00:00:00" styleClass="status-value"/>
            </HBox>
            
            <Label text="|" styleClass="status-separator"/>
            
            <!-- AI è¿žæŽ¥çŠ¶æ€ -->
            <HBox spacing="5.0" alignment="CENTER_LEFT">
                <Label text="AI çŠ¶æ€:" styleClass="status-label"/>
                <Label fx:id="aiStatusLabel" text="æœªè¿žæŽ¥" styleClass="status-value status-ai"/>
            </HBox>
            
            <Label text="|" styleClass="status-separator"/>
            
            <!-- æ•°æ®åº“çŠ¶æ€ -->
            <HBox spacing="5.0" alignment="CENTER_LEFT">
                <Label text="æ•°æ®åº“:" styleClass="status-label"/>
                <Label fx:id="dbStatusLabel" text="å°±ç»ª" styleClass="status-value status-db"/>
            </HBox>
        </HBox>
    </bottom>
</BorderPane>

