<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.LineChart?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.chart.XYChart?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TitledPane?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.AnchorPane?>

<!--
    主界面布局文件
    使用 BorderPane 作为根容器，右上角固定按钮
    包含：标题标签、网卡列表视图、操作按钮区域
-->
<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.netpulse.netpulsefx.MainController"
            stylesheets="@main-view.css">
    <!-- 设置整体内边距 -->
    <padding>
        <Insets bottom="20.0" left="20.0" right="20.0" top="20.0"/>
    </padding>

    <!-- 右上角固定按钮组 -->
    <top>
        <AnchorPane>
            <!-- 标题标签：提示用户选择监控网卡 -->
            <Label fx:id="titleLabel" text="请选择监控网卡" 
                   style="-fx-font-size: 18px; -fx-font-weight: bold;"
                   AnchorPane.leftAnchor="0.0" AnchorPane.topAnchor="0.0"/>
            
            <!-- 右上角操作按钮组 -->
            <HBox spacing="10.0" alignment="CENTER_RIGHT"
                  AnchorPane.rightAnchor="0.0" AnchorPane.topAnchor="0.0">
                <!-- 查看历史数据按钮：打开历史数据查看窗口 -->
                <Button fx:id="viewHistoryButton" text="查看历史数据" onAction="#onViewHistoryButtonClick"
                        style="-fx-pref-width: 120px;"/>
                
                <!-- 开始监控按钮：启动对选中网卡的流量监控 -->
                <Button fx:id="startMonitorButton" text="开始监控" onAction="#onStartMonitorButtonClick"
                        style="-fx-pref-width: 120px;"/>
                
                <!-- 停止监控按钮：停止当前的流量监控 -->
                <Button fx:id="stopMonitorButton" text="停止监控" onAction="#onStopMonitorButtonClick"
                        style="-fx-pref-width: 120px;" disable="true"/>
            </HBox>
        </AnchorPane>
    </top>

    <!-- 主要内容区域 -->
    <center>
        <VBox spacing="15.0">
            <!-- 网卡选择区域：使用 ComboBox 下拉框选择网卡 -->
            <HBox spacing="10.0" alignment="CENTER_LEFT">
                <ComboBox fx:id="networkInterfaceComboBox" promptText="请选择要监控的网卡..." 
                          prefWidth="400.0" HBox.hgrow="ALWAYS"/>
                <Button fx:id="refreshNICButton" text="刷新" onAction="#onRefreshButtonClick"
                        style="-fx-pref-width: 80px;"/>
            </HBox>

            <!-- 概览看板：实时数据卡片 -->
            <Label text="流量概览" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
            <HBox spacing="15.0" alignment="CENTER_LEFT">
                <!-- 实时下行速度卡片 -->
                <VBox styleClass="overview-card" spacing="5.0" prefWidth="180.0">
                    <Label text="实时下行" styleClass="overview-card-title"/>
                    <HBox spacing="4.0" alignment="BASELINE_LEFT">
                        <Label fx:id="realtimeDownLabel" text="0.00" styleClass="overview-card-value"/>
                        <Label text="KB/s" styleClass="overview-card-unit"/>
                    </HBox>
                </VBox>
                
                <!-- 实时上行速度卡片 -->
                <VBox styleClass="overview-card" spacing="5.0" prefWidth="180.0">
                    <Label text="实时上行" styleClass="overview-card-title"/>
                    <HBox spacing="4.0" alignment="BASELINE_LEFT">
                        <Label fx:id="realtimeUpLabel" text="0.00" styleClass="overview-card-value"/>
                        <Label text="KB/s" styleClass="overview-card-unit"/>
                    </HBox>
                </VBox>
                
                <!-- 峰值速度卡片 -->
                <VBox styleClass="overview-card" spacing="5.0" prefWidth="180.0">
                    <Label text="峰值速度" styleClass="overview-card-title"/>
                    <HBox spacing="4.0" alignment="BASELINE_LEFT">
                        <Label fx:id="peakSpeedLabel" text="0.00" styleClass="overview-card-value"/>
                        <Label text="KB/s" styleClass="overview-card-unit"/>
                    </HBox>
                </VBox>
                
                <!-- 总流量卡片 -->
                <VBox styleClass="overview-card" spacing="5.0" prefWidth="180.0">
                    <Label text="本次统计总流量" styleClass="overview-card-title"/>
                    <HBox spacing="4.0" alignment="BASELINE_LEFT">
                        <Label fx:id="totalTrafficLabel" text="0.00" styleClass="overview-card-value"/>
                        <Label text="MB" styleClass="overview-card-unit"/>
                    </HBox>
                </VBox>
            </HBox>

            <!-- 实时流量波形图：显示网络流量的实时变化
                 X轴：时间（CategoryAxis）
                 Y轴：流量 KB/s（NumberAxis）
                 禁用动画以提升实时渲染性能 -->
            <Label text="实时流量监控" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
            <LineChart fx:id="trafficChart" animated="false" VBox.vgrow="ALWAYS" createSymbols="false" styleClass="area-chart">
                <xAxis>
                    <CategoryAxis label="时间" />
                </xAxis>
                <yAxis>
                    <NumberAxis label="流量 (KB/s)" />
                </yAxis>
                <minHeight>250.0</minHeight>
            </LineChart>

            <!-- 进程流量监控面板 -->
            <TitledPane text="进程流量详情" collapsible="true" expanded="true">
                <TableView fx:id="processTrafficTable" VBox.vgrow="ALWAYS">
                    <columns>
                        <TableColumn fx:id="processNameColumn" text="应用" prefWidth="200.0" />
                        <TableColumn fx:id="processPidColumn" text="PID" prefWidth="80.0" />
                        <TableColumn fx:id="processDownloadSpeedColumn" text="下载速度" prefWidth="120.0" />
                        <TableColumn fx:id="processUploadSpeedColumn" text="上传速度" prefWidth="120.0" />
                    </columns>
                    <minHeight>200.0</minHeight>
                    <maxHeight>300.0</maxHeight>
                </TableView>
            </TitledPane>
        </VBox>
    </center>
    
    <!-- 底部状态栏 -->
    <bottom>
        <HBox spacing="20.0" alignment="CENTER_LEFT" styleClass="status-bar">
            <padding>
                <Insets bottom="5.0" left="15.0" right="15.0" top="5.0"/>
            </padding>
            
            <!-- 系统运行时间 -->
            <HBox spacing="5.0" alignment="CENTER_LEFT">
                <Label text="运行时间:" styleClass="status-label"/>
                <Label fx:id="uptimeLabel" text="00:00:00" styleClass="status-value"/>
            </HBox>
            
            <Label text="|" styleClass="status-separator"/>
            
            <!-- AI 连接状态 -->
            <HBox spacing="5.0" alignment="CENTER_LEFT">
                <Label text="AI 状态:" styleClass="status-label"/>
                <Label fx:id="aiStatusLabel" text="未连接" styleClass="status-value status-ai"/>
            </HBox>
            
            <Label text="|" styleClass="status-separator"/>
            
            <!-- 数据库状态 -->
            <HBox spacing="5.0" alignment="CENTER_LEFT">
                <Label text="数据库:" styleClass="status-label"/>
                <Label fx:id="dbStatusLabel" text="就绪" styleClass="status-value status-db"/>
            </HBox>
        </HBox>
    </bottom>
</BorderPane>

